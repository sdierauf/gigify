(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;c="fWhzvRX8MxP35pNx",a="CXWHF3RAFXNLY9EHI",d="http://api.eventful.com/json/events/search",b="http://developer.echonest.com/api/v4/playlist/static",e=["January","February","March","April","May","June","July","August","September","October","November","December"],m=!1,$(document).ready(function(){return $("#search-bar").keypress(function(a){return 13===a.which?(i(this.value),m=!0):void 0})}),i=function(a){return $.ajax({url:d,type:"GET",dataType:"jsonp",data:{app_key:c,where:a,category:"music",sort_order:"popularity"},success:k})},k=function(a){var b,c,d,e,h,i,k,l,m,o,p,q,r,s,t,u;if(d=[],e=[],!a.events)return void g();for(t=a.events.event,p=0,r=t.length;r>p;p++){if(c=t[p],i=c.city_name+", "+c.region_abbr,o=c.venue_name,b=n(c.start_time),m=c.url,h=c.image.url.replace("small","block250"),l=[],c.performers)if(c.performers.performer instanceof Array)for(u=c.performers.performer,q=0,s=u.length;s>q;q++)k=u[q],l.push(k.name),d.push("eventful:artist:"+k.id);else l.push(c.performers.performer.name),d.push("eventful:artist:"+c.performers.performer.id);e.push({location:i,venue:o,date:b,url:m,image:h,performers:l})}return f(e),j(d.unique().slice(0,5)),j(d.unique().slice(5,10))},f=function(a){var b,c,d,e,f,g,h,i,j;for(m&&($("#upcoming-shows-header").remove(),$(".event").remove()),f=$("<h2 />",{id:"upcoming-shows-header",html:"<hr>Upcoming Shows"}),f.hide().insertAfter("#spotify-player").fadeIn(1e3),j=[],h=0,i=a.length;i>h;h++)e=a[h],d=$("<div />",{"class":"event col-sm-6 center-block"}),b=$("<a />",{"class":"event-image-shadow"}),g=$("<img />",{src:e.image,"class":"event-image"}),c=$("<div />",{"class":"event-body",html:'<span class="event-performer">'+e.performers.join(", ")+'</span><br><span class="event-venue">'+e.venue+'</span><br><span class="event-location">'+e.location+'</span><br><a href="'+e.url+'"><span class="event-date">'+e.date+"</span></a>"}),b.append(g),d.append(b).append(c),j.push(d.hide().appendTo("#events").fadeIn(1e3));return j},j=function(c){return $.ajax({url:b,type:"GET",dataType:"jsonp",traditional:"true",data:{api_key:a,artist:c,variety:1,format:"jsonp",results:20,type:"artist",bucket:["id:spotify-US","tracks","audio_summary"],adventurousness:0},success:l})},l=function(a){var b,c,d,e,f;for(c=[],f=a.response.songs,d=0,e=f.length;e>d;d++)b=f[d],b.tracks.length&&c.push(b.tracks[0].foreign_id.split(":")[2]);return h(c)},h=function(a){var b;return $("#spotify-player").empty(),m&&$("#spotify-frame").remove(),b=$("#spotify-frame"),0!==b.length?b.appendAttr("src",","+a.join(",")):$("<iframe />",{src:"https://embed.spotify.com/?theme=white&&view=coverart&uri=spotify:trackset:Gigify:"+a.join(","),frameborder:"0",allowtransparency:"true",id:"spotify-frame"}).hide().appendTo("#spotify-player").fadeIn(1e3)},g=function(){var a;return $("#spotify-player").empty(),$("#events").empty(),$("#upcoming-shows-header").remove(),a=$("<h2 />",{text:'Could not find results for "'+$("#search-bar").val()+'"...'}),a.css("color","#90a8a8"),a.hide().appendTo("#spotify-player").fadeIn(500)},Array.prototype.unique=function(){var a,b,c,d,e,f;for(b={},a=d=0,e=this.length;e>=0?e>d:d>e;a=e>=0?++d:--d)b[this[a]]=this[a];f=[];for(a in b)c=b[a],f.push(c);return f},$.fn.appendAttr=function(a,b){return this.attr(a,function(a,c){return c+b}),this},n=function(a){var b,c,d;return a=a.split(" ")[0],d=a.split("-")[0],c=a.split("-")[1],b=a.split("-")[2],""+e[parseInt(c)-1]+" "+b+", "+d}}).call(this);